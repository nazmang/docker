version: '3.3'
services:
 transmission:
  image: haugene/transmission-openvpn:3.7.1
  ports:
    - "9091:9091"
    - "1888:1888"
    - "51413:51413"
  volumes:
    - /etc/localtime:/etc/localtime:ro
    - Install:/Install
    - Movies:/Movies
    - Serials:/Serials
    - transmission_data:/data
    - transmission_config:/config
    - ${PWD}/client.ovpn:/etc/openvpn/custom/default.ovpn
  environment:
    - PEER_DNS=true
    - CREATE_TUN_DEVICE=true
    - WEBPROXY_ENABLED=true
    - WEBPROXY_PORT=1888
  env_file:
    - vpn.env
  cap_add:
    - NET_ADMIN
  logging:
    driver: json-file
    options:
      max-size: 10m
  healthcheck:
    test: ["CMD-SHELL", "curl -sS http://localhost:9091/transmission/web/ || exit 1"]
    interval: 120s
    timeout: 30s
    retries: 5     
  deploy:
    placement:
        constraints:
          - "node.role==manager"
    restart_policy:
       condition: on-failure
volumes:
  Install:
    driver: local 
    driver_opts:
      type: "nfs"
      o: "addr=192.168.2.56,rsize=65536,wsize=65536,timeo=300,tcp,rw,noatime"
      device: ":/mnt/big_pool/Install"
  Movies:
    driver: local 
    driver_opts:
      type: "nfs"
      o: "addr=192.168.2.56,rsize=65536,wsize=65536,timeo=300,tcp,rw,noatime"
      device: ":/mnt/trash_pool/Movies"
  Serials:
    driver: local 
    driver_opts:
      type: "nfs"
      o: "addr=192.168.2.56,rsize=65536,wsize=65536,timeo=300,tcp,rw,noatime"
      device: ":/mnt/trash_pool/old_data/f/Acht"
  transmission_data:
    driver: local 
    driver_opts:
      type: "nfs"
      o: "addr=192.168.2.56,rsize=65536,wsize=65536,timeo=300,tcp,rw,noatime"
      device: ":/mnt/trash_pool/old_data/"
  transmission_config:
    driver: local 
    driver_opts:
      type: "nfs"
      o: "addr=192.168.2.56,rsize=65536,wsize=65536,timeo=300,tcp,rw,noatime"
      device: ":/mnt/trash_pool/old_data/.config"

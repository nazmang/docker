version: "3.8"

services:
  gateway:
    build:
      context: ./gateway
    image: nazman/nginx-gateway:${GATEWAY_TAG:-1.0.0}
    ports:
      - 80:80
    networks:
      - gw_net
  cloudflared:
    image: cloudflare/cloudflared:${CLOUDFLARED_TAG:-latest}
    command: tunnel run --protocol http2
    environment:
      TUNNEL_TOKEN: ${TUNNEL_TOKEN}
    networks:
      - gw_net

networks:
  gw_net:
    attachable: true
    driver: overlay
